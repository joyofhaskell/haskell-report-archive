\noindent\bprogB
\mbox{\tt --\ Complex\ Numbers}\\
\mbox{\tt }\\
\mbox{\tt module\ PreludeComplex\ (\ Complex(:+)\ )\ \ where}
\eprogB\noindent\bprogB
\mbox{\tt infix\ \ 6\ \ :+}
\eprogB\noindent\bprogB
\mbox{\tt data\ \ (RealFloat\ a)\ \ \ \ \ =>\ Complex\ a\ =\ a\ :+\ a\ \ deriving\ (Eq,Binary,Text)}
\eprogB\noindent\bprogB
\mbox{\tt instance\ \ (RealFloat\ a)\ =>\ Num\ (Complex\ a)\ \ where}\\
\mbox{\tt \ \ \ \ (x:+y)\ +\ (x':+y')\ \ \ =\ \ (x+x')\ :+\ (y+y')}\\
\mbox{\tt \ \ \ \ (x:+y)\ -\ (x':+y')\ \ \ =\ \ (x-x')\ :+\ (y-y')}\\
\mbox{\tt \ \ \ \ (x:+y)\ *\ (x':+y')\ \ \ =\ \ (x*x'-y*y')\ :+\ (x*y'+y*x')}\\
\mbox{\tt \ \ \ \ negate\ (x:+y)\ \ \ \ \ \ \ =\ \ negate\ x\ :+\ negate\ y}\\
\mbox{\tt \ \ \ \ abs\ z\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \ magnitude\ z\ :+\ 0}\\
\mbox{\tt \ \ \ \ signum\ 0\ \ \ \ \ \ \ \ \ \ \ \ =\ \ 0}\\
\mbox{\tt \ \ \ \ signum\ z@(x:+y)\ \ \ \ \ =\ \ x/r\ :+\ y/r\ \ where\ r\ =\ magnitude\ z}\\
\mbox{\tt \ \ \ \ fromInteger\ n\ \ \ \ \ \ \ =\ \ fromInteger\ n\ :+\ 0}
\eprogB\noindent\bprogB
\mbox{\tt instance\ \ (RealFloat\ a)\ =>\ Fractional\ (Complex\ a)\ \ where}\\
\mbox{\tt \ \ \ \ (x:+y)\ /\ (x':+y')\ \ \ =\ \ (x*x''+y*y'')\ /\ d\ :+\ (y*x''-x*y'')\ /\ d}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ x''\ =\ scaleFloat\ k\ x'}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y''\ =\ scaleFloat\ k\ y'}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k\ \ \ =\ -\ (max\ (exponent\ x')\ (exponent\ y'))}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ d\ \ \ =\ x'*x''\ +\ y'*y''}\\
\mbox{\tt }\\
\mbox{\tt \ \ \ \ fromRational\ a\ \ \ \ \ \ =\ \ fromRational\ a\ :+\ 0}
\eprogB\noindent\bprogB
\mbox{\tt instance\ \ (RealFloat\ a)\ =>\ Floating\ (Complex\ a)\ where}\\
\mbox{\tt \ \ \ \ pi\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \ pi\ :+\ 0}\\
\mbox{\tt \ \ \ \ exp\ (x:+y)\ \ \ \ \ =\ \ expx\ *\ cos\ y\ :+\ expx\ *\ sin\ y}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ expx\ =\ exp\ x}\\
\mbox{\tt \ \ \ \ log\ z\ \ \ \ \ \ \ \ \ \ =\ \ log\ (magnitude\ z)\ :+\ phase\ z}\\
\mbox{\tt }\\
\mbox{\tt \ \ \ \ sqrt\ 0\ \ \ \ \ \ \ \ \ =\ \ 0}\\
\mbox{\tt \ \ \ \ sqrt\ z@(x:+y)\ \ =\ \ u\ :+\ (if\ y\ <\ 0\ then\ -v\ else\ v)}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ (u,v)\ =\ if\ x\ <\ 0\ then\ (v',u')\ else\ (u',v')}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v'\ \ \ \ =\ abs\ y\ /\ (u'*2)}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u'\ \ \ \ =\ sqrt\ ((magnitude\ z\ +\ abs\ x)\ /\ 2)}\\
\mbox{\tt }\\
\mbox{\tt \ \ \ \ sin\ (x:+y)\ \ \ \ \ =\ \ sin\ x\ *\ cosh\ y\ :+\ cos\ x\ *\ sinh\ y}\\
\mbox{\tt \ \ \ \ cos\ (x:+y)\ \ \ \ \ =\ \ cos\ x\ *\ cosh\ y\ :+\ sin\ x\ *\ sinh\ y}\\
\mbox{\tt \ \ \ \ tan\ (x:+y)\ \ \ \ \ =\ \ (sinx*coshy:+cosx*sinhy)/(cosx*coshy:+sinx*sinhy)}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ sinx\ \ =\ sin\ x}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cosx\ \ =\ cos\ x}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sinhy\ =\ sinh\ y}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coshy\ =\ cosh\ y}\\
\mbox{\tt }\\
\mbox{\tt \ \ \ \ sinh\ (x:+y)\ \ \ \ =\ \ cos\ y\ *\ sinh\ x\ :+\ sin\ \ y\ *\ cosh\ x}\\
\mbox{\tt \ \ \ \ cosh\ (x:+y)\ \ \ \ =\ \ cos\ y\ *\ cosh\ x\ :+\ (-\ (sin\ y)\ *\ sinh\ x)}\\
\mbox{\tt \ \ \ \ tanh\ (x:+y)\ \ \ \ =\ \ (cosy*sinhx:+siny*coshx)/(cosy*coshx:+(-siny*sinhx))}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ siny\ \ =\ sin\ y}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cosy\ \ =\ cos\ y}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sinhx\ =\ sinh\ x}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coshx\ =\ cosh\ x}\\
\mbox{\tt }\\
\mbox{\tt \ \ \ \ asin\ z@(x:+y)\ \ =\ \ y':+(-x')}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ \ (x':+y')\ =\ log\ ((-y:+x)\ +\ sqrt\ (1\ -\ z*z))}\\
\mbox{\tt \ \ \ \ acos\ z@(x:+y)\ \ =\ \ y'':+(-x'')}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where\ (x'':+y'')\ =\ log\ (z\ +\ ((-y'):+x'))}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (x':+y')\ \ \ =\ sqrt\ (1\ -\ z*z)}\\
\mbox{\tt \ \ \ \ atan\ z@(x:+y)\ \ =\ \ y':+(-x')}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where}\\
\mbox{\tt \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (x':+y')\ =\ log\ (((-y+1):+x)\ *\ sqrt\ (1/(1+z*z)))}\\
\mbox{\tt }\\
\mbox{\tt \ \ \ \ asinh\ z\ \ \ \ \ \ \ \ =\ \ log\ (z\ +\ sqrt\ (1+z*z))}\\
\mbox{\tt \ \ \ \ acosh\ z\ \ \ \ \ \ \ \ =\ \ log\ (z\ +\ (z+1)\ *\ sqrt\ ((z-1)/(z+1)))}\\
\mbox{\tt \ \ \ \ atanh\ z\ \ \ \ \ \ \ \ =\ \ log\ ((z+1)\ *\ sqrt\ (1\ -\ 1/(z*z)))}
\eprogB
